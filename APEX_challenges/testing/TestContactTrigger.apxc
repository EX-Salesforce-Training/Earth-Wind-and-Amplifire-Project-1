@isTest
public class TestContactTrigger {
    
	@TestSetup
    public static void setup() {
        List<Account> accList = new List<Account>();
        List<String> sites = new List<String> { 'www.naruto.com', 'www.facebook.com', 'www.google.com'};
        
        for(String site: sites) {
            Account acc = new Account();
            acc.Name = Math.random() + ' WOO!';
            acc.Site = site;
            accList.add(acc);
        }
        
        insert accList;
    }
    
    @isTest
    static void createCon() {
        Contact c = new Contact();
        c.Email = 'swiggitySwag@naruto.com';
        c.LastName = 'swag';
        insert c;
        
        Account acc = [SELECT Id FROM Account WHERE Site = 'www.naruto.com' ][0];
        Contact con = [SELECT AccountId FROM Contact WHERE Email='swiggitySwag@naruto.com'][0];
        System.assertEquals(acc.id, con.accountId);
    }
    
    @isTest
    static void failToConnectToAccount() {
        Contact c = new Contact();
        c.Email = 'swiggitySwag@fake.com';
        c.LastName = 'swag';
        insert c;
        
        Account accList = [SELECT Id, (SELECT AccountId FROM Contacts) FROM Account];
        for(Account acc: accList) {
            System.assert(acc.Contacts.isEmpty());
        }
    }
    
    @isTest
    static void testBulk() {
        List<Contact> conList = new List<Contact>();

        List<String> domains = new List<String>{ 'naruto.com', 'facebook.com', 'google.com'};
        for(String domain: domains) {
            Contact c = new Contact();
            c.Email = 'swiggitySwag@' + domain;
            c.LastName = 'swag' + Math.random();
            conList.add(c);
        }
        insert conList;
        
        List<Account> accList = 
            [SELECT Id, 
             (SELECT AccountId FROM Contacts) 
             FROM Account 
             WHERE Id IN 
             (SELECT AccountId FROM Contact)];
       
        for(Account acc: accList) {
            for(Contact con: acc.Contacts) {
            	System.assertNotEquals(con.accountId, null);
            	System.assertEquals(con.AccountId, acc.Id);
            }
        }
    }
}